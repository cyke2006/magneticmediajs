/* 
Copyright (C) 2014 Arnaud Leyder 

This file is part of Magneticmediajs starter edition - v 1.0.2

Magneticmediajs library starter edition is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Magneticmediajs library starter edition is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Magneticmediajs library starter edition.  If not, see <http://www.gnu.org/licenses/>.

For contact information please visit <http://www.magneticmediajs.com/support.html>
*/

var mmItemOnStage=!1,mmTimerSpin,mmTimerSpin2,mmTimerSpin3; (function(b){function t(){return navigator.userAgent.toLowerCase().match(/(iphone|ipod)/g)?window.innerHeight:b(window).height()}function p(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,d,f){return b+b+d+d+f+f});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function v(a,b,c,d,f,h){var g=a/b;768>c?(f/=2.5,h/=2.5,c=Math.floor(75*c/100),d=Math.floor(75*d/100)):768<=c&&1024>c?(f/=1.5,h/=1.5,c=Math.floor(80* c/100),d=Math.floor(80*d/100)):(c=Math.floor(82*c/100),d=Math.floor(82*d/100));a>c&&b>d?(a=c,b=Math.floor(a/g),b>d&&(b=d,a=Math.floor(b*g))):a>c?(a=c,b=Math.floor(a/g)):b>d?(b=d,a=Math.floor(b*g)):(a=c,b=Math.floor(a/g),b>d&&(b=d,a=Math.floor(b*g)));g=[];g[0]=a;g[1]=b;g[2]=f;g[3]=h;return g}function z(a,e,c,d,f,h,g,s){var p=b(window).width(),q=t(),k=new Image;k.id="mmImgFull";b(k).appendTo(".mmFSWrapper");b(k).on("load",function(){var a=u(k),l=a[0],a=a[1],m=v(l,a,p,q,h,g),l=m[0],a=m[1],A=m[2],m=m[3]; b(".mmFSWrapper").css({width:l+"px",height:a+"px","max-width":"","max-height":""}).fadeIn(300);e&&""!==c&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+c+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));b(".mmFSWrapper").css({border:A+"px solid #"+d,"border-radius":m+"px"});b(".mmTitleArea").css({color:"#"+f,background:"#"+d,"border-radius":Math.round(m)+"px"});b(".mmClose").css({color:"#"+f});clearTimeout(mmTimerSpin);clearInterval(mmTimerSpin2);clearInterval(mmTimerSpin3);b("#mmParentSpin").hide()}); b(k).on("error",function(){b(this).remove();alert("An error occurred while loading this content. Please try again later.")});k.src=a}function u(a){var e=[];a.naturalWidth?(e[0]=a.naturalWidth,e[1]=a.naturalHeight):((new Image).src=a.src,b(newImage).on("load",function(){e[0]=this.width;e[1]=this.height}));return e}function B(a,e){b(".mmWaitCircle").css({background:"#"+a});b("#mmParentSpin").css({border:"2px solid #"+a,background:"#"+e})}function w(a){a.stopPropagation();a.data.param1.find("img");switch(a.which){case 32:a.preventDefault(); 0>=b(document).find(".mmFullScreen").length&&a.data.param1.trigger("click");break;case 27:a.preventDefault(),b(".mmFullScreen").fadeOut(300,function(){b(this).remove();mmItemOnStage=s=!1})}}function C(a){for(var e=b(location).attr("search"),e=e.substr(1).split("&"),c=0;c<e.length;c++)if("magnetid"===e[c].split("=")[0]&&e[c].split("=")[1]===a){var d=e[c].split("=")[1],d=d.replace(/^mm/,"");b("#"+d).trigger("click")}}function x(){b("#mmWaitCircle1").animate({opacity:0},400,function(){b("#mmWaitCircle2").animate({opacity:0}, 400,function(){b("#mmWaitCircle3").animate({opacity:0},400,function(){})})})}function y(){b("#mmWaitCircle1").animate({opacity:1},400,function(){b("#mmWaitCircle2").animate({opacity:1},400,function(){b("#mmWaitCircle3").animate({opacity:1},400,function(){})})})}var s=!1,n={init:function(a){a=b.extend({data:[],displayTitle:!1,color1:"080808",color2:"f7f7f7",borderWidth:8,borderRadius:8,background:"000000",backgroundOpacity:.7},a);var e=a.data,c=a.displayTitle,d=a.color1,f=a.color2,h=a.borderWidth; 20<h?h=20:0>h&&(h=0);var g=a.borderRadius;20<g?g=20:0>g&&(g=0);var n=a.background,u=a.backgroundOpacity,q=b(this);b(this).attr("tabindex","0");a=b(this);var k="mm"+b(this).attr("id"),r=!0;b("body").append('<div id="mmParentSpin"><div class="mmWaitCircle" id="mmWaitCircle1"></div><div class="mmWaitCircle" id="mmWaitCircle2"></div><div class="mmWaitCircle" id="mmWaitCircle3"></div></div>');a.on("touchend",function(b){r&&(r=!1,b.stopPropagation(),b.preventDefault(),b.target.click(),setTimeout(function(){r= !0},200))});a.on("click",function(a){a.stopPropagation();a="";b("body").append('<div class="mmFullScreen"></div>');mmTimerSpin=setTimeout(function(){b("#mmParentSpin").show();x();y();mmTimerSpin2=setInterval(function(){x()},1200);mmTimerSpin3=setInterval(function(){y()},1200)},300);B(d,f);var l=p("#"+n).r,D=p("#"+n).g,E=p("#"+n).b,F=b(window).width(),r=t();b(".mmFullScreen").css({width:F+"px",height:r+"px",background:"rgba("+l+","+D+","+E+","+u+")"});b(".mmFullScreen").append('<div class="mmFSWrapper" id="'+ k+'"><div class="mmClose icon-cancel"></div></div>');c&&(a=e[0][2]);"image"===e[0][0]&&(z(e[0][1],c,a,d,f,h,g,q),mmItemOnStage=s=!0);b(".mmFullScreen").on("touchend",function(a){var c=b(a.target);c.parents(".mmFSWrapper").length&&!c.hasClass("mmClose")||a.target.click()});b(".mmFullScreen").on("click",function(a){a=b(a.target);a.parents(".mmFSWrapper").length&&!a.hasClass("mmClose")||b(".mmFullScreen").fadeOut(300,function(){b(this).remove();mmItemOnStage=s=!1})})});C(k);q.on("focusout",function(){b(document).off("keydown", w)});q.on("focusin",function(){b(document).on("keydown",{param1:b(this)},w)});var l=!1;b(window).on("resize",function(){l||(setTimeout(function(){var a=b(".mmFSWrapper").width(),c=b(".mmFSWrapper").height(),d=b(window).width(),e=t(),f=[];s&&(f=v(a,c,d,e,h,g));var a=f[0],c=f[1],k=f[2],f=f[3];b(".mmFullScreen").css({width:d+"px",height:e+"px"});d=b(".mmFSWrapper").css("border-left-color");b(".mmFSWrapper").css({width:a+"px",height:c+"px",border:k+"px solid "+d,"border-radius":f+"px"});l=!1},100),l= !0)});return this}};b.fn.magneticmediajs=function(a){if(n[a])return n[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)b.error("Method "+a+" does not exist on jQuery plugin");else return n.init.apply(this,arguments)}})(jQuery);