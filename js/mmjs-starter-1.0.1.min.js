/* 
Copyright (C) 2014 Arnaud Leyder 

This file is part of Magneticmediajs starter edition

Magneticmediajs library starter edition is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Magneticmediajs library starter edition is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Magneticmediajs library starter edition.  If not, see <http://www.gnu.org/licenses/>.

For contact information please visit <http://www.magneticmediajs.com/support.html>
*/

(function(b){function n(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,h){return b+b+c+c+h+h});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function r(a,b,d,c,h,k,g){var f=a/b;768>d?(h/=2.5,k/=2.5,d=Math.floor(75*d/100),c=Math.floor(75*c/100)):768<=d&&1024>d?(h/=1.5,k/=1.5,d=Math.floor(80*d/100),c=Math.floor(80*c/100)):(d=Math.floor(82*d/100),c=Math.floor(82*c/100));a>d&&b>c?(a=d,b=Math.floor(a/f), b>c&&(b=c,a=Math.floor(b*f))):a>d?(a=d,b=Math.floor(a/f),"maps"===g&&b<c&&(b=c)):b>c?(b=c,a=Math.floor(b*f),"maps"===g&&a<d&&(a=d)):(a=d,b=Math.floor(a/f),b>c&&(b=c,a=Math.floor(b*f)));g=[];g[0]=a;g[1]=b;g[2]=h;g[3]=k;return g}function t(a,e,d,c,h,k,g){var f=b(window).width(),n=b(window).height(),l=new Image;l.id="mmImgFull";l.src=a;b(l).appendTo(".mmFSWrapper");b(l).on("load",function(){var a=q(l),m=a[0],a=a[1],p=r(m,a,f,n,k,g),m=p[0],a=p[1],v=p[2],p=p[3];b(".mmFSWrapper").css({width:m+"px",height:a+ "px","max-width":"","max-height":""}).fadeIn(300);e&&""!==d&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+d+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));b(".mmFSWrapper").css({border:v+"px solid #"+c,"border-radius":p+"px"});b(".mmTitleArea").css({color:"#"+h,background:"#"+c,"border-radius":Math.round(p)+"px"});b(".mmClose").css({color:"#"+h})})}function q(a){var e=[];a.naturalWidth?(e[0]=a.naturalWidth,e[1]=a.naturalHeight):((new Image).src=a.src,b(newImage).on("load",function(){e[0]= this.width;e[1]=this.height}));return e}function w(){for(var a=b(location).attr("search"),a=a.substr(1).split("&"),e=0;e<a.length;e++)"magnetid"===a[e].split("=")[0]&&b("#"+a[e].split("=")[1]).trigger("click")}function s(a){a.stopPropagation();var e=a.data.param1;switch(a.which){case 32:a.preventDefault();e.trigger("click");break;case 27:a.preventDefault(),b(".mmFullScreen").fadeOut(300,function(){b(this).remove()})}}b.fn.magneticmediajs=function(a){a=b.extend({data:[],displayTitle:!1,color1:"000000", color2:"EEEEEE",borderWidth:12,borderRadius:6,background:"000000",backgroundOpacity:.7,manageViewport:!0},a);var e=a.data,d=a.displayTitle,c=a.color1,h=a.color2,k=a.borderWidth;20<k?k=20:0>k&&(k=0);var g=a.borderRadius;20<g?g=20:0>g&&(g=0);var f=a.background,q=a.backgroundOpacity;a.manageViewport&&(a=b("meta[name=viewport]"),0<a.length||(b('<meta name="viewport" />').appendTo("head"),a=b("meta[name=viewport]")),a.attr("content","width=device-width,initial-scale=1,minimal-ui"));b(window).width();b(window).height(); var l=!1;a=b(this);var u=b(this).attr("id");a.on("touchstart",function(a){a.stopPropagation();a.preventDefault();a.target.click()});a.on("click",function(a){a.stopPropagation();b(".mmFSWrapper").off("mouseleave mouseenter");a="";b("body").append('<div class="mmFullScreen"></div>');var m=n("#"+f).r,x=n("#"+f).g,y=n("#"+f).b,z=b(window).width(),A=b(window).height();b(".mmFullScreen").css({width:z+"px",height:A+"px",background:"rgba("+m+","+x+","+y+","+q+")"});b(".mmFullScreen").append('<div class="mmFSWrapper" id="'+ u+'"><div class="mmClose icon-cancel"></div></div>');d&&"image"===e[0][0]&&"undefined"!==typeof e[0][2]&&(a=e[0][2]);"image"===e[0][0]&&(t(e[0][1],d,a,c,h,k,g),l=!0);b(".mmFullScreen").on("touchstart",function(a){var c=b(a.target);c.parents(".mmFSWrapper").length&&!c.hasClass("mmClose")||a.target.click()});b(".mmFullScreen").on("click",function(a){a=b(a.target);a.parents(".mmFSWrapper").length&&!a.hasClass("mmClose")||b(".mmFullScreen").fadeOut(300,function(){b(this).remove();l=!1})})});w();a.on("focusout", function(){b(document).off("keydown",s)});a.on("focusin",function(){b(document).on("keydown",{param1:b(this)},s)});var m=!1;b(window).on("resize",function(){m||(setTimeout(function(){var a=b(".mmFSWrapper").width(),d=b(".mmFSWrapper").height(),e=b(window).width(),h=b(window).height(),f=[];l&&(f=r(a,d,e,h,k,g,"picture"));var a=f[0],d=f[1],n=f[2],f=f[3];b(".mmFullScreen").css({width:e+"px",height:h+"px"});b(".mmFSWrapper").css({width:a+"px",height:d+"px",border:n+"px solid #"+c,"border-radius":f+"px"}); m=!1},100),m=!0)});return this}})(jQuery);