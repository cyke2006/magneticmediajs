/*
Copyright (C) 2014 Arnaud Leyder at Leyder Consulting

This file is part of Magneticmediajs starter edition v1.1.0

Magneticmediajs starter edition is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Magneticmediajs library starter edition is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with Magneticmediajs library starter edition. If not, see http://www.gnu.org/licenses/.

For contact information please visit https://www.magneticmediajs.com/
*/
var mmItemOnStage=!1,mmTimerSpin,mmTimerSpin2,mmTimerSpin3; (function(b){function v(){return navigator.userAgent.toLowerCase().match(/(iphone|ipod)/g)?window.innerHeight:b(window).height()}function x(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,g){return b+b+c+c+g+g});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function w(a,b,d,c,g,f,l){var k=a/b;768>d?(g/=2.5,f/=2.5,d=Math.floor(75*d/100),c=Math.floor(75*c/100)):768<=d&&1024>d?(g/=1.5,f/=1.5,d=Math.floor(80* d/100),c=Math.floor(80*c/100)):(d=Math.floor(82*d/100),c=Math.floor(82*c/100));a>d&&b>c?(a=d,b=Math.floor(a/k),b>c&&(b=c,a=Math.floor(b*k))):a>d?(a=d,b=Math.floor(a/k),"maps"===l&&b<c&&(b=c)):b>c?(b=c,a=Math.floor(b*k),"maps"===l&&a<d&&(a=d)):(a=d,b=Math.floor(a/k),b>c&&(b=c,a=Math.floor(b*k)));l=[];l[0]=a;l[1]=b;l[2]=g;l[3]=f;return l}function z(a,e){0===a&&0<e&&(b(".mmFSWrapper > img").css("border-radius",e+"px"),b(".mmFSWrapper > video").css("border-radius",e+"px"))}function E(a,e,d,c,g,f,l,k){var n= b(window).width(),p=v(),h=new Image;h.id="mmImgFull";b(h).appendTo(".mmFSWrapper");b(h).on("load",function(){var a=F(h),k=a[0],a=a[1],m=w(k,a,n,p,f,l,"picture"),k=m[0],a=m[1],q=m[2],m=m[3];b(".mmFSWrapper").css({width:k+"px",height:a+"px","max-width":"","max-height":""}).fadeIn(300);e&&""!==d&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+d+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));A(c,g,q,m);clearTimeout(mmTimerSpin);clearInterval(mmTimerSpin2);clearInterval(mmTimerSpin3); b("#mmParentSpin").hide();z(q,m)});b(h).on("error",function(){b(this).remove();mmLoadHtml('<div id="mmErrorWrapper"><div id="mmError">An error occurred while loading this content. Please try again later.</div></div>',c,g,f,l,"",k)});h.src=a}function G(a,e,d,c,g,f,l,k,n,p,h,s,r){a=b(window).width();r=v();"mmSingleItem"===d&&(d=e,e="");var m=!1;document.createElement("video").canPlayType&&""!==document.createElement("video").canPlayType("video/mp4")&&(m=!0);if(m)var q='<video controls poster="'+e+'" src="'+ d+'" class="mmVideoPlayer" '+(f?"autoplay":"")+' preload="auto"></video>';else"http:"!==d.substring(0,5)&&(d="../"+d),swfobject.hasFlashPlayerVersion("10")&&(e=encodeURIComponent(e),d=encodeURIComponent(d),q='<div class="mmVideoPlayer"><object width="100%" height="100%"><param name="movie" value="flash/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src='+d+"&poster="+e+"&controlBarAutoHide=true&autoPlay="+f+'"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="transparent"></param><embed width="100%" height="100%" src="flash/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="transparent" flashvars="src='+ d+"&poster="+e+"&controlBarAutoHide=true&autoPlay="+f+'"></embed></object>');h=w(c,g,a,r,h,s,"video");width=h[0];height=h[1];f=h[2];h=h[3];b(".mmFSWrapper").append(q);b(".mmFSWrapper,.mmVideoPlayer").css({width:width+"px",height:height+"px","max-width":c+"px","max-height":g+"px"}).fadeIn(300);l&&""!==k&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+k+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));A(n,p,f,h);clearTimeout(mmTimerSpin);clearInterval(mmTimerSpin2);clearInterval(mmTimerSpin3); b("#mmParentSpin").hide();z(f,h)}function F(a){var e=[];a.naturalWidth?(e[0]=a.naturalWidth,e[1]=a.naturalHeight):((new Image).src=a.src,b(newImage).on("load",function(){e[0]=this.width;e[1]=this.height}));return e}function A(a,e,d,c){if(a===e)var g=a,f="000";else g=a,f=e;b(".mmFSWrapper").css({border:d+"px solid #"+a,"border-radius":c+"px"});b(".mmTitleArea").css({color:"#"+f,background:"#"+g,"border-radius":Math.round(c)+"px"});b(".mmClose").css({color:"#"+e})}function H(a,e){if(a===e)var d=a,c= "000";else d=a,c=e;b(".mmWaitCircle").css({background:"#"+d});b("#mmParentSpin").css({border:"2px solid #"+d,background:"#"+c})}function B(a){a.stopPropagation();var e=a.data.param1.find("img");switch(a.which){case 32:a.preventDefault();0>=b(document).find(".mmFullScreen").length&&(a.data.param1.hasClass("mmGeneric")?e.trigger("click"):a.data.param1.trigger("click"));break;case 27:a.preventDefault(),b(".mmFullScreen").fadeOut(300,function(){b(this).remove();delete mmMapInstance;mmMapInstance=null; mmItemOnStage=mapsOnStage=htmlOnStage=s=t=!1})}}function I(a,e,d){for(var c=b(location).attr("search"),c=c.substr(1).split("&"),g=0;g<c.length;g++)if("magnetid"===c[g].split("=")[0]&&c[g].split("=")[1]===a)if(e)b("#"+c[g].split("=")[1]+" > img").trigger("click");else if(d)b("#"+c[g].split("=")[1]).trigger("click");else{var f=c[g].split("=")[1],f=f.replace(/^mm/,"");b("#"+f).trigger("click")}}function C(){b("#mmWaitCircle1").animate({opacity:0},400,function(){b("#mmWaitCircle2").animate({opacity:0}, 400,function(){b("#mmWaitCircle3").animate({opacity:0},400,function(){})})})}function D(){b("#mmWaitCircle1").animate({opacity:1},400,function(){b("#mmWaitCircle2").animate({opacity:1},400,function(){b("#mmWaitCircle3").animate({opacity:1},400,function(){})})})}var t=!1,s=!1,u={init:function(a){a=b.extend({data:[],displayTitle:!1,color1:"080808",color2:"fdfdfd",borderWidth:8,borderRadius:8,background:"000000",backgroundOpacity:.7,videoWidth:640,videoHeight:360,autoPlayVideo:!1},a);var e=a.data,d= a.videoWidth,c=a.videoHeight,g=a.autoPlayVideo,f=a.displayTitle,l=a.color1,k=a.color2,n=a.borderWidth;20<n?n=20:0>n&&(n=0);var p=a.borderRadius;20<p?p=20:0>p&&(p=0);var h=a.background,u=a.backgroundOpacity,r=b(this);b(this).attr("tabindex","0");a=b(this);var m="mm"+b(this).attr("id"),q=!0;b("body").append('<div id="mmParentSpin"><div class="mmWaitCircle" id="mmWaitCircle1"></div><div class="mmWaitCircle" id="mmWaitCircle2"></div><div class="mmWaitCircle" id="mmWaitCircle3"></div></div>');a.on("touchend", function(b){q&&(q=!1,b.stopPropagation(),b.preventDefault(),b.target.click(),setTimeout(function(){q=!0},200))});a.on("click",function(a){a.stopPropagation();a="";b("body").append('<div class="mmFullScreen"></div>');mmTimerSpin=setTimeout(function(){b("#mmParentSpin").show();C();D();mmTimerSpin2=setInterval(function(){C()},1200);mmTimerSpin3=setInterval(function(){D()},1200)},300);H(l,k);var q=x("#"+h).r,J=x("#"+h).g,K=x("#"+h).b,L=b(window).width(),M=v();b(".mmFullScreen").css({width:L+"px",height:M+ "px",background:"rgba("+q+","+J+","+K+","+u+")"});b(".mmFullScreen").append('<div class="mmFSWrapper" id="'+m+'"><div class="mmClose icon-cancel"></div></div>');f&&"image"===e[0][0]&&"undefined"!==typeof e[0][2]&&(a=e[0][2]);"image"===e[0][0]?(E(e[0][1],f,a,l,k,n,p,r),t=!1,mmItemOnStage=s=!0):"video"===e[0][0]&&(G(e[0][0],e[0][1],"mmSingleItem",d,c,g,f,a,l,k,n,p,r),t=!0,s=!1,mmItemOnStage=!0);b(".mmFullScreen").on("touchend",function(a){var c=b(a.target);c.parents(".mmFSWrapper").length&&!c.hasClass("mmClose")|| a.target.click()});b(".mmFullScreen").on("click",function(a){a=b(a.target);a.parents(".mmFSWrapper").length&&!a.hasClass("mmClose")||b(".mmFullScreen").fadeOut(300,function(){b(this).remove();mmItemOnStage=s=t=!1})})});I(m);r.on("focusout",function(){b(document).off("keydown",B)});r.on("focusin",function(){b(document).on("keydown",{param1:b(this)},B)});var y=!1;b(window).on("resize",function(){y||(setTimeout(function(){var a=b(".mmFSWrapper").width(),c=b(".mmFSWrapper").height(),d=b(window).width(); r.parent().width();var e=v();r.parent().height();var g="",f=[];r.position();s?(g="picture",f=w(a,c,d,e,n,p,g)):t&&(g="video",f=w(a,c,d,e,n,p,g));var a=f[0],c=f[1],h=f[2],f=f[3];b(".mmFullScreen").css({width:d+"px",height:e+"px"});d=b(".mmFSWrapper").css("border-left-color");b(".mmFSWrapper").css({width:a+"px",height:c+"px",border:h+"px solid "+d,"border-radius":f+"px"});"video"===g&&b(".mmVideoPlayer").css({width:a+"px",height:c+"px"});y=!1},100),y=!0)});return this}};b.fn.magneticmediajs=function(a){if(u[a])return u[a].apply(this, Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)b.error("Method "+a+" does not exist on jQuery plugin");else return u.init.apply(this,arguments)}})(jQuery);