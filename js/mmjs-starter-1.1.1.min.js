/*
Copyright (C) 2014 Arnaud Leyder at Leyder Consulting

This file is part of Magneticmediajs starter edition v1.1.1

Magneticmediajs starter edition is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Magneticmediajs library starter edition is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with Magneticmediajs library starter edition. If not, see http://www.gnu.org/licenses/.

For contact information please visit https://www.magneticmediajs.com/
*/
var mmItemOnStage=!1,mmTimerSpin,mmTimerSpin2,mmTimerSpin3; (function(b){function v(){return navigator.userAgent.toLowerCase().match(/(iphone|ipod)/g)?window.innerHeight:b(window).height()}function x(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,d,g){return b+b+d+d+g+g});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function w(a,b,c,d,g,f,l){var k=a/b;768>c?(g/=2.5,f/=2.5,c=Math.floor(75*c/100),d=Math.floor(75*d/100)):768<=c&&1024>c?(g/=1.5,f/=1.5,c=Math.floor(80* c/100),d=Math.floor(80*d/100)):(c=Math.floor(82*c/100),d=Math.floor(82*d/100));a>c&&b>d?(a=c,b=Math.floor(a/k),b>d&&(b=d,a=Math.floor(b*k))):a>c?(a=c,b=Math.floor(a/k),"maps"===l&&b<d&&(b=d)):b>d?(b=d,a=Math.floor(b*k),"maps"===l&&a<c&&(a=c)):(a=c,b=Math.floor(a/k),b>d&&(b=d,a=Math.floor(b*k)));l=[];l[0]=a;l[1]=b;l[2]=g;l[3]=f;return l}function y(a,e){0===a&&0<e&&(b(".mmFSWrapper > img").css("border-radius",e+"px"),b(".mmFSWrapper > video").css("border-radius",e+"px"))}function D(a,e,c,d,g,f,l,k){var n= b(window).width(),p=v(),h=new Image;h.id="mmImgFull";b(h).appendTo(".mmFSWrapper");b(h).on("load",function(){var a=E(h),k=a[0],a=a[1],m=w(k,a,n,p,f,l,"picture"),k=m[0],a=m[1],q=m[2],m=m[3];b(".mmFSWrapper").css({width:k+"px",height:a+"px","max-width":"","max-height":""}).fadeIn(300);e&&""!==c&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+c+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));z(d,g,q,m);clearTimeout(mmTimerSpin);clearInterval(mmTimerSpin2);clearInterval(mmTimerSpin3); b(".mmParentSpin").hide();y(q,m)});b(h).on("error",function(){b(this).remove();mmLoadHtml('<div id="mmErrorWrapper"><div id="mmError">An error occurred while loading this content. Please try again later.</div></div>',d,g,f,l,"",k)});h.src=a}function F(a,e,c,d,g,f,l,k,n,p,h,s,r){a=b(window).width();r=v();"mmSingleItem"===c&&(c=e,e="");var m=!1;document.createElement("video").canPlayType&&""!==document.createElement("video").canPlayType("video/mp4")&&(m=!0);if(m)var q='<video controls poster="'+e+'" src="'+ c+'" class="mmVideoPlayer" '+(f?"autoplay":"")+' preload="auto"></video>';else"http:"!==c.substring(0,5)&&"https:"!==c.substring(0,5)&&(c="../"+c),swfobject.hasFlashPlayerVersion("10")&&(e=encodeURIComponent(e),c=encodeURIComponent(c),q='<div class="mmVideoPlayer"><object width="100%" height="100%"><param name="movie" value="flash/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src='+c+"&poster="+e+"&controlBarAutoHide=true&autoPlay="+f+'"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="transparent"></param><embed width="100%" height="100%" src="flash/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="transparent" flashvars="src='+ c+"&poster="+e+"&controlBarAutoHide=true&autoPlay="+f+'"></embed></object>');h=w(d,g,a,r,h,s,"video");width=h[0];height=h[1];f=h[2];h=h[3];b(".mmFSWrapper").append(q);b(".mmFSWrapper,.mmVideoPlayer").css({width:width+"px",height:height+"px","max-width":d+"px","max-height":g+"px"}).fadeIn(300);l&&""!==k&&(b(".mmFSWrapper").append('<div class="mmTitleArea">'+k+"</div>"),b(".mmFSWrapper").css({"margin-top":"-15px"}));z(n,p,f,h);clearTimeout(mmTimerSpin);clearInterval(mmTimerSpin2);clearInterval(mmTimerSpin3); b(".mmParentSpin").hide();y(f,h)}function E(a){var e=[];a.naturalWidth?(e[0]=a.naturalWidth,e[1]=a.naturalHeight):((new Image).src=a.src,b(newImage).on("load",function(){e[0]=this.width;e[1]=this.height}));return e}function z(a,e,c,d){if(a===e)var g=a,f="000";else g=a,f=e;b(".mmFSWrapper").css({border:c+"px solid #"+a,"border-radius":d+"px"});b(".mmTitleArea").css({color:"#"+f,background:"#"+g,"border-radius":Math.round(d/2)+"px"});b(".mmClose").css({color:"#"+e})}function G(a,e){if(a===e)var c=a, d="000";else c=a,d=e;b(".mmWaitCircle").css({background:"#"+c});b(".mmParentSpin").css({border:"2px solid #"+c,background:"#"+d})}function A(a){a.stopPropagation();var e=a.data.param1.find("img");switch(a.which){case 32:a.preventDefault();0>=b(document).find(".mmFullScreen").length&&(a.data.param1.hasClass("mmGeneric")?e.trigger("click"):a.data.param1.trigger("click"));break;case 27:a.preventDefault(),b(".mmFullScreen").fadeOut(300,function(){b(this).remove();delete mmMapInstance;mmMapInstance=null; mmItemOnStage=mapsOnStage=htmlOnStage=s=t=!1})}}function H(a,e,c){for(var d=b(location).attr("search"),d=d.substr(1).split("&"),g=0;g<d.length;g++)if("magnetid"===d[g].split("=")[0]&&d[g].split("=")[1]===a)if(e)b("#"+d[g].split("=")[1]+" > img").trigger("click");else if(c)b("#"+d[g].split("=")[1]).trigger("click");else{var f=d[g].split("=")[1],f=f.replace(/^mm/,"");b("#"+f).trigger("click")}}function B(){b(".mmWaitCircle1").animate({opacity:0},400,function(){b(".mmWaitCircle2").animate({opacity:0}, 400,function(){b(".mmWaitCircle3").animate({opacity:0},400,function(){})})})}function C(){b(".mmWaitCircle1").animate({opacity:1},400,function(){b(".mmWaitCircle2").animate({opacity:1},400,function(){b(".mmWaitCircle3").animate({opacity:1},400,function(){})})})}var t=!1,s=!1,u={init:function(a){a=b.extend({data:[],displayTitle:!1,color1:"080808",color2:"fdfdfd",borderWidth:8,borderRadius:8,background:"000000",backgroundOpacity:.7,videoWidth:640,videoHeight:360,autoPlayVideo:!1},a);var e=a.data,c= a.videoWidth,d=a.videoHeight,g=a.autoPlayVideo,f=a.displayTitle,l=a.color1,k=a.color2,n=a.borderWidth;20<n?n=20:0>n&&(n=0);var p=a.borderRadius;20<p?p=20:0>p&&(p=0);var h=a.background,u=a.backgroundOpacity,r=b(this);b(this).attr("tabindex","0");a=b(this);var m="mm"+b(this).attr("id");b("body").has(".mmParentSpin").length||b("body").append('<div class="mmParentSpin"><div class="mmWaitCircle mmWaitCircle1"></div><div class="mmWaitCircle mmWaitCircle2"></div><div class="mmWaitCircle mmWaitCircle3"></div></div>'); a.on("touchend",function(a){b("body").has(".mmFullScreen").length||(a.stopPropagation(),a.preventDefault(),a.target.click())});a.on("click",function(a){if(!b("body").has(".mmFullScreen").length){a.stopPropagation();a="";b("body").append('<div class="mmFullScreen"></div>');mmTimerSpin=setTimeout(function(){b(".mmParentSpin").show();B();C();mmTimerSpin2=setInterval(function(){B()},1200);mmTimerSpin3=setInterval(function(){C()},1200)},300);G(l,k);var q=x("#"+h).r,I=x("#"+h).g,J=x("#"+h).b,K=b(window).width(), L=v();b(".mmFullScreen").css({width:K+"px",height:L+"px",background:"rgba("+q+","+I+","+J+","+u+")"});b(".mmFullScreen").append('<div class="mmFSWrapper" id="'+m+'"><div class="mmClose icon-cancel"></div></div>');f&&"image"===e[0][0]&&"undefined"!==typeof e[0][2]&&(a=e[0][2]);"image"===e[0][0]?(D(e[0][1],f,a,l,k,n,p,r),t=!1,mmItemOnStage=s=!0):"video"===e[0][0]&&(F(e[0][0],e[0][1],"mmSingleItem",c,d,g,f,a,l,k,n,p,r),t=!0,s=!1,mmItemOnStage=!0);b(".mmFullScreen").on("touchend",function(a){var c=b(a.target); c.parents(".mmFSWrapper").length&&!c.hasClass("mmClose")||a.target.click()});b(".mmFullScreen").on("click",function(a){a=b(a.target);a.parents(".mmFSWrapper").length&&!a.hasClass("mmClose")||b(".mmFullScreen").fadeOut(300,function(){b(this).remove();mmItemOnStage=s=t=!1})})}});H(m);r.on("focusout",function(){b(document).off("keydown",A)});r.on("focusin",function(){b(document).on("keydown",{param1:b(this)},A)});var q=!1;b(window).on("resize",function(){q||(setTimeout(function(){var a=b(".mmFSWrapper").width(), c=b(".mmFSWrapper").height(),d=b(window).width();r.parent().width();var e=v();r.parent().height();var g="",f=[];r.position();s?(g="picture",f=w(a,c,d,e,n,p,g)):t&&(g="video",f=w(a,c,d,e,n,p,g));var a=f[0],c=f[1],h=f[2],f=f[3];b(".mmFullScreen").css({width:d+"px",height:e+"px"});d=b(".mmFSWrapper").css("border-left-color");b(".mmFSWrapper").css({width:a+"px",height:c+"px",border:h+"px solid "+d,"border-radius":f+"px"});"video"===g&&b(".mmVideoPlayer").css({width:a+"px",height:c+"px"});q=!1},100),q= !0)});return this}};b.fn.magneticmediajs=function(a){if(u[a])return u[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)b.error("Method "+a+" does not exist on jQuery plugin");else return u.init.apply(this,arguments)}})(jQuery);